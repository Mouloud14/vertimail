<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>{{ folder | capitalize }} | Vertimail</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>

<div class="app-container">
    {# --- Sidebar (Menu de gauche) --- #}
    <aside class="sidebar">
        <h1 class="app-title">Vertimail</h1>

        <a href="/compose?user={{ username }}" class="btn-compose">Nouveau Message</a>

        <nav class="menu">
            <a href="/box?username={{ username }}&folder=inbox" class="nav-link {{ folder == 'inbox' ? 'active' : '' }}">
                <span>Réception</span>
                {% if unreadCount > 0 %}
                    <span class="unread-badge">{{ unreadCount }}</span>
                {% endif %}
            </a>
            <a href="/box?username={{ username }}&folder=outbox" class="nav-link {{ folder == 'outbox' ? 'active' : '' }}">Envoyés</a>
            <a href="/box?username={{ username }}&folder=draft" class="nav-link {{ folder == 'draft' ? 'active' : '' }}">Brouillons</a>
            <a href="/box?username={{ username }}&folder=trash" class="nav-link {{ folder == 'trash' ? 'active' : '' }}">Corbeille</a>
        </nav>

        <div class="user-info">
            Connecté en tant que :<br>
            <strong>{{ username }}</strong>
            <a href="/" class="logout-link">Se déconnecter</a>
        </div>
    </aside>

    {# --- Contenu Principal (Liste des emails) --- #}
    <main class="main-content">
        <header class="content-header">
            <h2>{{ folder | capitalize }}</h2>
            <span>{{ mails | length }} messages</span>
        </header>

        <div class="scrollable-content">
            <ul class="email-list">
                {% if mails is empty %}
                    <li style="text-align: center; padding: 50px; color: var(--text-muted);">Ce dossier est vide.</li>
                {% else %}
                    {% for mail in mails %}
                        {# On applique le style 'unread' SEULEMENT si on est dans l'INBOX et que le message n'est pas lu #}
                        {% set isUnread = (folder == 'inbox' and not mail.isRead) %}

                        <a href="/read?username={{ username }}&folder={{ folder }}&id={{ mail.id }}" class="email-item {{ isUnread ? 'unread' : '' }}">
                            <div class="email-sender">{{ folder == 'outbox' ? 'À : ' ~ mail.to : mail.from }}</div>
                            <div class="email-subject">{{ mail.subject | default('(Sans objet)') }}</div>
                            <div class="email-date">{{ mail.date | slice(8, 10) }}/{{ mail.date | slice(5, 7) }}/{{ mail.date | slice(0, 4) }}</div>
                        </a>
                    {% endfor %}
                {% endif %}
            </ul>
        </div>
    </main>
</div>

</body>
</html>
